--- 
# REP2.16
# Telescope Framework

---
# 主要目标

- Telescope 望远镜系统最主要目标是根据多层芯片击中位置信息重建入射粒子径迹
- 在此基础上还能实现测量待测芯片（DUT）的分辨率的功能


---

# 主要过程

- 数据读取与坐标转换
- 像素信息转化为簇团
- 根据多层芯片簇团信息拟合直线，重建径迹计算残差
- 统计DUT残差，计算分辨率

---
# 数据读取与坐标转换

- 由上一个模块输出的数据转化为后续使用的信息：
	- 输入数据格式：
		- 每个event均为一个Dict，key为芯片序列，value为着火的像素以及对应的收集电荷量
		- 示例：{0:[ [1,1,58] , [1,2,60] ],1:[ [ 1,1,100] ]}，表示的是第0块芯片中(1,1)号像素收集58电子，(1,2)号像素收集60电子，第1块芯片(1,1)号像素收集100电子
	 - 转化序列号为局部坐标：局部坐标指芯片中的相对位置

---
# 像素信息转化为簇团
- 将每层芯片中击中的像素转化为簇团
	- 原因：由于charge sharing，一个粒子穿过一层芯片的时候会让多个像素产生响应
	- 簇团定义：相邻的像素即可视为处于一个簇团，相邻的判据一般为像素有共同边或者共同顶点
		即计算像素中心点距离是否小于一个上限，使用邻边作为判据时即两点距离小于pixel的尺寸
		邻顶点判据则是pixel尺寸*$\sqrt{2}$ ,下图中对于1像素，使用邻边作为判据23与其属于同一簇团，使用
		邻顶点判据则4也属于同一个簇团
	- ![捕获.PNG](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%8D%95%E8%8E%B7.PNG)
	 
	- 簇团中心位置计算：![未命名的圖片.png](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%9C%AA%E5%91%BD%E5%90%8D%E7%9A%84%E5%9C%96%E7%89%87.png)

# 根据多层芯片簇团信息拟合直线，重建径迹计算残差
- 使用多层芯片簇团中心位置，结合芯片所处的位置，即可拟合直线
- ![捕获1.PNG](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%8D%95%E8%8E%B71.PNG)
- 在拟合直线时，除了DUT以外的芯片都参与直线的拟合。将拟合出来的直线与DUT交点和DUT上实际击中的簇团中心位置比较，得到x,y两个方向上的残差

# 统计DUT残差，计算分辨率
- 将DUT的残差进行统计后，进行高斯拟合，得到拟合的方差即可初步视为DUT的分辨率
- DUT的理论分辨率等于 像素尺寸/$\sqrt{12}$ , 对于25um像素，理论分辨率可以达到7um，而考虑到charge sharing, 实际分辨率甚至还会更好些
- ![Layer_3_x.png](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/Layer_3_x.png)
