
[[符晨曦]]

ssh git code Xming

# 第一部分：ssh登陆服务器-vscode作为客户端

- 爆盘问题：
- home下的空间不够，不足以装载vscode的服务器端
- 需要通过软连接将vscode放到其他磁盘
- 方法：使用ssh登录服务器（如果vscode初始化失败并报错Disk quota exceeded，证明确实发生了爆盘，需要从终端登录）
	- `ssh 用户名@lxslc7.ihep.ac.cn`
- 如果vscode爆盘了，在服务器里：
	- 移动到想要装载vscode服务器端的文件夹
		- `cd /workfs2/用户组/用户名/` 
	- 在文件夹下创建vscode服务器端文件夹
		- `mkdir .vscode-server`
	- 回到home
	- 如果有vscode服务器端，卸载掉
		- 查看方法：`ls -a`
		- `rm -rf .vscode-server`
- 如果没有爆盘，用终端：
	- 将.vscode-server移动到其他硬盘：
		- `mv .vscode-server /workfs2/用户组/用户名/`
- 创建一个软连接
	- `ln -s /workfs2/用户组/用户名/.vscode-server .`
		- 注意后面的空格和点
- 执行cd之后执行ls，如果有浅蓝色软链接就代表成功
- 用vscode登录服务器

- 使用vscode作为客户端
	- [[VSCode]]
- 安装remote-vscode插件
- 左边会出现remote栏
- ![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2010.57.01.png)
- 在SSH栏中添加SSH链接
	- `ssh 用户名@lxslc7.ihep.ac.cn`
- 会弹出一个窗口，对应访问服务器的vscode，没弹出就手动从左下角连接
- ![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2011.03.42.png)
- ![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2011.04.12.png)
- 成功连接服务器后会让你输密码，第一次登录会在服务器上下载vscode-server
- 如果vscode让你手动选服务器操作系统，选linux
- 进入服务器后可以打开文件夹或者从终端访问文件

- 免密登录：
- mac系统
	- 在本地的终端使用两条命令：
		- `ssh-keygen
			- （之后连续按三次回车即可）
		- `ssh-copy-id 用户名@lxslc7.ihep.ac.cn`
	- 登录之后在服务器上使用命令：
		- `aklog -d`
	- 之后即可免密登录服务器
- windows 系统
	- 在powershell中运行以下脚本：
		- ```function ssh-copy-id([string]$userAtMachine, $args){   
			$publicKey = "$ENV:USERPROFILE" + "/.ssh/id_rsa.pub"
			if (!(Test-Path "$publicKey")){
				Write-Error "ERROR: failed to open ID file '$publicKey': No such file"            
			}
			else {
				 & cat "$publicKey" | ssh $args $userAtMachine "umask 077; test -d .ssh || mkdir .ssh ; cat >> .ssh/authorized_keys || exit 1"      
			}
		}
	- 在本地的终端使用两条命令：
		- `ssh-keygen
			- （之后连续按三次回车即可）
		- `ssh-copy-id 用户名@lxslc7.ihep.ac.cn`
	- 之后即可免密登录服务器




- 查看pdf：
- 下载vscode-pdf扩展
- 在打开pdf时右键选择打开方式，里面会有选择默认打开方式的选项，选择vscode-pdf

# 第二部分：git仓库的获取、更新与提交

- 在浏览器上用高能所账号登录高能所GitLab
- code.ihep.ac.cn
- 进入RASER/raser，在屏幕右侧找到Fork
- ![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2016.41.39.png)
- 点击Fork之后逐步配置，就拥有了自己的raser代码仓库

- 进入自己的仓库后（用户名/raser，区别于RASER/raser），在屏幕右侧找到clone
- ![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2016.42.54.png)
- 获取到克隆的地址

- 登陆服务器，在主页文件夹下执行命令
- `git clone 克隆的地址`
- 即可在服务器上获取到代码仓库
	- 此时即可用vscode打开该仓库，后面的部分git仓库也可通过code实现
	- 推荐本地上找一个文件夹重复此操作，做备份同时方便obsidian的使用
		- 如果这样需要设置`git config pull.rebase false`

- 设置用户信息
	`git config user.name 用户名`
	`git config user.email 邮箱`
- 设置上游仓库
	`git remote add upstream https://code.ihep.ac.cn/raser/raser.git`
- 获取上游更新
	`git fetch upstream`
	`git merge upstream/master`
- 改动代码后在本地确认保存改动
	`git add`将改动送入缓存区（推荐使用`git add .`全部送入）
	`git commit -m ""`确认保存（引号内是注释）
- 查看代码库情况（有哪些改动）
	`git status`
- 将自己的更新推送到远程代码仓库
	`git push`
- 将自己的更新合并到组内主仓库中
	- 进入高能所GitLab，在自己项目的页面或主项目的页面中找到Merge requests
![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2016.58.12.png)
然后在右上角点击New merge request
![](https://raser-1314796952.cos.ap-beijing.myqcloud.com/media/%E6%88%AA%E5%B1%8F2023-01-12%2016.58.53.png)
填写相应信息后提交

# 第三部分：linux使用与raser试运行

- 在code里打开终端或在本地连接ssh
- 进入服务器页面
- 常用命令：
	- 查看信息类：
		- `ls查看当前文件夹下内容，-a查看隐藏文件，-l查看文件信息`
		- `cd切换文件夹，.代表当前文件夹，..代表上级文件夹，/代表根目录，cd不加目的地回到主页`
		- `pwd查看当前文件夹路径`
	- 文件操作类
		- `mkdir新建文件夹`
		- `code编辑文件，用vscode`
		- `rm删除文件，-r删除文件夹，-f强制删除`
			- 万恶的`rm -rf /`的梗来源（服务器上不会让你用出来；自己的生产环境千万不能用！）
		- `ln创建软链接，可以理解为快捷方式`

- 服务器上的代码依托run运行
- 常用的运行流程：
	- 登录服务器
	- 打开raser文件夹（可以使用cd也可以用vscode访问）
	- 输入`./run 选项号` 例如 `./run 1.1.1`
	- 在`output`文件夹下查看运行结果
		- 目前有些输出会在`fig`下

- 不同配置分散在paras/setting.json run 和各种.py文件中