#Bootstrap: docker
#From: library/debian:11.7    

Bootstrap: localimage
From: raser-2.3.sif  

%post
    ## Use huaweicloud  
    ## May need to do $ srouce /etc/profile 
    #sed -i "s@http://deb.debian.org@http://repo.huaweicloud.com@g" /etc/apt/sources.list
    #apt update 
    #apt upgrade

    ## Build 
    #apt -y install apt-utils git wget vim  
    #apt -y install build-essential libboost-all-dev 

    ## ROOT 
    #apt -y install llvm libxpm-dev libxft-dev libxext-dev libgif-dev 
    #cd /usr/local/share
    #mkdir root_build root_install 
    #wget https://root.cern/download/root_v6.26.06.source.tar.gz
    #tar xzf root_v6.26.06.source.tar.gz 
    #mv root-6.26.06 root_src 
    #rm -rf root_v6.26.06.source.tar.gz 
    #cd /usr/local/share/root_build
    #cmake -DCMAKE_INSTALL_PREFIX=../root_install ../root_src 
    #cmake --build . -- install -j$(nproc)   
    

    ## Geant4-pybind    
    #ln -sf /usr/bin/python3 /usr/bin/python 
    #apt -y install python3-pip libice6 libsm6  
    #pip install matplotlib scipy pandas geant4-pybind 

    ## DevSim    
    #pip install mkl devsim 
    #pip install mkl -U # mkl-2024.0.0
    #pip install devsim -U # 2.7.0

    ## NGSpice & KiCAD
    #apt -y install ngspice 
    #apt -y install kicad 

    ## ALiBaVa 
    #pip install pylandau tqdm numba h5py PyYAML joblib 

    ## ACTC
    #cd /usr/local/share
    #git clone https://gitlab.com/raser-team/external/acts acts_src
    #cd acts_src 
    #git checkout v29.2.0
    #cd .. 
    #mkdir acts_build
    #apt install cmake libeigen3-dev libtbb-dev
    # apt list libtbb-dev
    #cmake -B acts_build -S acts_src 
    #cmake --build acts_build -j28 

    #vim acts_src/thirdparty/dfelibs/CMakeLists.txt # replace github to gitlab 
    #cmake --trace -B acts_build -S acts_src -DACTS_BUILD_EXAMPLES_PYTHON_BINDINGS=ON
    #cmake --build acts_build -j$(nproc) # -v for verbose 
    #Note: need to do a clean to avoid stuck 

    ## pyMTL3 
    # apt install python-dev libffi-dev ##no need
    # pip install pymtl3 

    ## Build and install Verilator
    # apt install flex g++ libfl-dev bison help2man
    # cd /usr/local/share 
    # git clone https://git.veripool.org/git/verilator
    # cd verilator 
    # git checkout stable 
    # autoconf
    # ./configure 
    # make -j24 
    # make install

    ## RISC-V software 
    # apt install autoconf automake autotools-dev curl libmpc-dev \
    #    libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo \
    #    gperf libtool patchutils bc zlib1g-dev git libexpat1-dev
    # mkdir /opt/riscv32i 
    # cd /usr/local/share
    # git clone https://gitlab.com/raser-team/external/riscv-gnu-toolchain.git
    # cd riscv-gnu-toolchain 
    # git submodule update --init --recursive 
    # mkdir build 
    # cd build 
    # ../configure --with-arch=rv32i --prefix=/opt/riscv32i 
    # make -j$(nproc) 
